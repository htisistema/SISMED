MEMVAR getlist,nivel_acess,mdata_sis
**** CON424.PRG: Relatorio -> Documentos PAGOS
******************************************************
FUNCTION con424(mtp_424)
****************
LOCAL MPRG:='CON424',;
      tela,t_ini,t_fim,f_ini,f_fim,l_mes,td_mes,tp_mes,u_dat,pag,;
      vencer,vencidas,t_vencer,t_vencidas,tot_dup,tot_jur,tot_des,vlr_dup,;
      vlr_jur,vlr_des,mtot_dup,mtot_jur,mtot_des,mvlr_dup,mvlr_jur,mvlr_des,;
      mquantd,mtit,mtipo,mtip,mdia,mt_dia,bank,mtipo_dup,mtip_pg:='  ',mcod_vend,;
      mloc_pg:=' ',marea:=SPACE(15),mcod_oper:=0,mjuros_d:=0,mjur_tot:=0,mtip_juro:=' ',;
      memi_venc:='N',mdoc_desc:='N',mcartao := SPACE(3),mt_pg:=0,mt_des:=0,mt_jur:=0,mtitulo,;
      mtot_doc:=0,mvlr_doc:=0,mqtd_dias:=0,lci:=0,cci:=0,lba:=16,cba:=78,mmov_cx,mtipo_sint,;
      nErr, nPos,vEmp := {},aret:={},nCnn,oSql,cComm, apCode,m_param:={},cons_cli:={},cons_dupr:={}

PRIVATE mcliente,mcgc,mcpf,mcod_cli,mnome_vend,mcom_ven,mali,;
        mtipo_imp,mimp_tipo:=0,marq:=SPACE(35),mcodemp:=SPACE(3),malias

IF mtp_424 = NIL
        IF ! ver_nivel(mprg,'CONTA A RECEBER (RELATORIO DOCUMENTO PAGOS)','15',nivel_acess,,'AMBIE')
                RETURN NIL
        ENDIF
        malias := 'dupr'
        mtitulo := '(CONTAS A RECEBER)'
ELSE
       IF ! ver_nivel(mprg+mtp_424,'CREDITO CLIENTE (RELATORIO DOCUMENTO PAGOS)','15',nivel_acess,,'AMBIE')
                RETURN NIL
        ENDIF
        malias := 'cred'
        mtitulo := '(CREDITO CLIENTE)'
ENDIF
*---------------------------------------------------------------------
CLOSE ALL
IF ! AbriArq('insopera','sen');RETURN NIL;ENDIF
IF ! AbriArq('sacsetup','set');RETURN NIL;ENDIF
IF ! AbriArq('saccli','cli');RETURN NIL;ENDIF
//IF ! AbriArq('sacdupr','dupr');RETURN NIL;ENDIF
//IF ! AbriArq('saccred','cred');RETURN NIL;ENDIF
IF ! AbriArq('sactipdc','tipdc');RETURN NIL;ENDIF
*---------------------------------------------------------------------
mtipo_imp := 'J'
mensagem('Preencha os dados que desejar')
op_tela(10,10,29,90,' Duplicatas Pagas ')
WHILE .T.
        @ lci+1,cci+1 SAY "Codigo da Empresa.:"                                                                                                                                                                                                                                                                         
        @ lci+2,cci+1 SAY "Codigo do Cliente.:"                                                                                                                                                                                                                                                                      
        @ lci+3,cci+1 SAY "[C]arteira [B]anco:"                                                                                                                                                                                                                                                                      
        @ lci+4,cci+1 SAY "Data do Inicio....:"                                                                                                                                                                                                                                                                      
        @ lci+5,cci+1 SAY "Data do Final.....:"                                                                                                                                                                                                                                                                      
        @ lci+6,cci+1 SAY "Tipo da Operacao..:"                                                                                                                                                                                                                                                                      
        @ lci+7,cci+1 SAY "Cod.Vendedor......:"                                                                                                                                                                                                                                                                      
        @ lci+8,cci+1 SAY "Local Pagamento...:"                                                                                                                                                                                                                                                                      
        @ lci+9,cci+1 SAY "Area do Cliente...:"                                                                                                                                                                                                                                                                      
        @ lci+10,cci+1 SAY "Tipo de Documento.:"                                                                                                                                                                                                                                                                     
        @ lci+11,cci+1 SAY "Cod.Operador......:"                                                                                                                                                                                                                                                                     
        @ lci+12,cci+1 SAY "So Doc.c/Juros Dispensado [S/N].....:"                                                                                                                                                                                                                                                   
        @ lci+13,cci+1 SAY "So Doc.c/Venc. e Emissao Igual [S/N]:"                                                                                                                                                                                                                                                   
        @ lci+14,cci+1 SAY "So Documento com DESCONTO [S/N].....:"                                                                                                                                                                                                                                                   
        @ lci+15,cci+1 SAY "So Documento c/Atraso acima de Dias.:"                                                                                                                                                                                                                                                   
        DEVPOS(lci+16,cci+1);DEVOUT("Tipo de Pagamento...................:")
        DEVPOS(lci+17,cci+1);DEVOUT("Tipo Relatorio [S]intetico p/Cliente:")
        mcod_cli:= mcod_vend := 0
        t_ini=mdata_sis                                                                                                                                                                                                                                                                                              
        t_fim=mdata_sis+30                                                                                                                                                                                                                                                                                           
        bank=SPACE(1)                                                                                                                                                                                                                                                                                                
        mtip_pg := mtip := '  '                                                                                                                                                                                                                                                                                      
        mloc_pg := ' '                                                                                                                                                                                                                                                                                               
        mtip_juro := memi_venc := mdoc_desc := 'N'                                                                                                                                                                                                                                                                   
        mmov_cx := ' '
        mtipo_sint := 'N'
        IF ! EMPTY(mcod_cli);ver_cli(mcod_cli,09,28);ENDIF                                                                                                                                                                                                                                                           
        @ lci+2,cci+21  GET mcod_cli PICT "99999" VALID ver_cli(mcod_cli,lci+1,cci+26)                                                                                                                                                                                                                            
        @ lci+3,cci+21  GET bank PICT '@!' VALID bank $ 'C,B, '                                                                                                                                                                                                                                                   
        @ lci+4,cci+21  GET t_ini VALID IF(EMPTY(t_ini),.F.,.T.)                                                                                                                                                                                                                                                  
        @ lci+5,cci+21  GET t_fim VALID IF(EMPTY(t_fim),.F.,.T.)                                                                                                                                                                                                                                                  
        @ lci+6,cci+21  GET mtip_pg PICT '@!'                                                                                                                                                                                                                                                                     
        @ lci+7,cci+21  GET mcod_vend PICT "999" VALID ven(mcod_vend,lci+7,cci+25) WHEN mcod_cli = 0                                                                                                                                                                                                              
        @ lci+8,cci+21  GET mloc_pg PICT "@!" VALID mloc_pg $ 'M,C, '                                                                                                                                                                                                                                             
        @ lci+9,cci+21  GET marea PICT "@!"                                                                                                                                                                                                                                                                       
        @ lci+10,cci+21 GET mtip PICT "@!" VALID ver_tipdc(mtip,'*')                                                                                                                                                                                                                                              
        @ lci+11,cci+21 GET mcod_oper PICT "999" VALID ven(mcod_oper,lci+11,cci+25) WHEN mcod_cli = 0                                                                                                                                                                                                             
        @ lci+12,cci+39 GET mtip_juro PICT "@!" VALID mtip_juro $ 'S,N'                                                                                                                                                                                                                                           
        @ lci+13,cci+39 GET memi_venc PICT "@!" VALID memi_venc $ 'S,N'                                                                                                                                                                                                                                           
        @ lci+14,cci+39 GET mdoc_desc PICT "@!" VALID mdoc_desc $ 'S,N'                                                                                                                                                                                                                                           
        @ lci+15,cci+39 GET mqtd_dias PICT "999"                                                                                                                                                                                                                                                                  
        @ lci+16,cci+39 GET mmov_cx PICT '@!' WHEN men_get(2,38,'Local de Pagamento [C]caixa e [M]ovimento')
        @ lci+17,cci+39 GET mtipo_sint PICT '@!' VALID mtipo_sint $ 'S,N' WHEN men_get(2,38,'Opcao : [S]im ou [N]ao')
        READ
        IF LASTKEY()=27                                                                                                                                                                                                                                                                                           
                EXIT                                                                                                                                                                                                                                                                                            
        ENDIF                                                                                                                                                                                                                                                                                                     
        l_mes=" "                                                                                                                                                                                                                                                                                                 
        td_mes:=tp_mes:=0    && tot. pagar no mes                                                                                                                                                                                                                                                                 
        IF mtip = 'DU'                                                                                                                                                                                                                                                                                            
                mtit := 'DUPLICATAS PAGAS ' + mtitulo                                                                                                                                                                                                                                                                  
                mtip := 'DU'                                                                                                                                                                                                                                                                                           
        ELSEIF mtip = 'CH'                                                                                                                                                                                                                                                                                        
                mtit := 'CHEQUES PAGOS ' + mtitulo                                                                                                                                                                                                                                                                     
                mtip := 'CH'                                                                                                                                                                                                                                                                                           
        ELSEIF mtip = 'CT'                                                                                                                                                                                                                                                                                        
                mtit := 'CARTOES PAGOS ' + mtitulo                                                                                                                                                                                                                                                                     
                mtip := 'CT'                                                                                                                                                                                                                                                                                           
                mcartao := SPACE(3)                                                                                                                                                                                                                                                                                    
                op_tela(00,00,02,75," CARTOES PAGOS ")                                                                                                                                                                                                                                                                 
                @ 00,02 SAY "Codigo do Cartao.........:"                                                                                                                                                                                                                                                               
                @ 00,29 GET mcartao PICT '999' VALID ver_cartao(VAL(mcartao),00,32) .AND. lim_get() WHEN men_get(01,29,'Informe o codigo do cartao ou deixe em branco para todos')                                                                                                                                     
                READ                                                                                                                                                                                                                                                                                                   
                IF LASTKEY() = 27                                                                                                                                                                                                                                                                                      
                        LOOP                                                                                                                                                                                                                                                                                                
                ENDIF                                                                                                                                                                                                                                                                                                  
                opcao := op_simnao('S','Confirma a Cartao:')                                                                                                                                                                                                                                                           
                IF opcao = 'N'                                                                                                                                                                                                                                                                                         
                        LOOP                                                                                                                                                                                                                                                                                                
                ENDIF                                                                                                                                                                                                                                                                                                  
        ELSEIF mtip = 'FI'                                                                                                                                                                                                                                                                                        
                mtit := 'FINANCEIRA PAGAS ' + mtitulo                                                                                                                                                                                                                                                                  
                mtip := 'FI'                                                                                                                                                                                                                                                                                           
                mcartao := SPACE(3)                                                                                                                                                                                                                                                                                    
                op_tela(00,00,02,75," FINANCEIRA PAGAS ")                                                                                                                                                                                                                                                              
                @ 00,02 SAY "Codigo do Financiamento..:"                                                                                                                                                                                                                                                               
                @ 00,29 GET mcartao PICT '999' VALID ver_cartao(VAL(mcartao),00,32) .AND. lim_get() WHEN men_get(02,29,'Informe o codigo do cartao ou deixe em branco para todos')                                                                                                                                     
                READ                                                                                                                                                                                                                                                                                                   
                IF LASTKEY() = 27                                                                                                                                                                                                                                                                                      
                        EXIT                                                                                                                                                                                                                                                                                            
                ENDIF                                                                                                                                                                                                                                                                                                  
                opcao := op_simnao('S','Confirma a Financeira:')                                                                                                                                                                                                                                                       
                wvw_lclosewindow()                                                                                                                                                                                                                                                                                     
                IF opcao = 'N'                                                                                                                                                                                                                                                                                         
                        LOOP                                                                                                                                                                                                                                                                                                
                ENDIF                                                                                                                                                                                                                                                                                                  
        ELSE                                                                                                                                                                                                                                                                                                      
                mtit := 'DOCUMENTOS PAGOS ' + mtitulo                                                                                                                                                                                                                                                                  
        ENDIF                                                                                                                                                                                                                                                                                                     
        mtipo_dup := mensagem1('So as duplicata com JUROS:','N','S,N')                                                                                                                                                                                                                                            
        IF LASTKEY()=27                                                                                                                                                                                                                                                                                           
                EXIT                                                                                                                                                                                                                                                                                            
        ENDIF                                                                                                                                                                                                                                                                                                     
        mensagem('Aguarde coletando dados para o relatorio.....')
        IF mtipo_sint = 'S'
                IF ! EMPTY(mcod_vend)
                        mtipo := DTOC(t_ini)+' a '+DTOC(t_fim)+' - '+STRZERO(mcod_vend,3)+'-'+mnome_vend
                ELSE
                        mtipo := DTOC(t_ini)+' a '+DTOC(t_fim)
                ENDIF
                pag:= vencer:= vencidas:= t_vencer:= t_vencidas:= tot_dup:= tot_jur:=;
                tot_des:= vlr_dup:= vlr_jur:= vlr_des:= mtot_dup:= mtot_jur:= mtot_des:=;
                mvlr_dup:= mvlr_jur:= mvlr_des:= mt_dia := mt_pg  := mt_des := mt_jur := ;
                mtot_doc := mvlr_doc := 0
                cons_cli:={}
                sr_getconnection():exec("SELECT * FROM saccli ORDER BY razao",,.t.,@cons_cli)
                IF LEN(cons_cli) = 0
                        atencao('Nao existe nenhum Cliente')
                        RETURN NIL
                ENDIF
                IF ! imp_arq('DOC_PAGAS.REL','R')
                        EXIT
                ENDIF
                i:=0
                FOR i = 1 TO LEN(cons_cli)
                        IF malias = 'dupr'
                                cComm  := "SELECT SUM(vlpago),COUNT(*) FROM sacdupr WHERE datpag >= "+sr_cdbvalue(t_ini)+" AND datpag <= "+sr_cdbvalue(t_fim)+" AND pago ='B'"
                        ELSE
                                cComm  := "SELECT SUM(vlpago),COUNT(*) FROM saccred WHERE datpag >= "+sr_cdbvalue(t_ini)+" AND datpag <= "+sr_cdbvalue(t_fim)+" AND pago ='B'"
                        ENDIF
                        ccomm := ccomm + " AND fornec = "+sr_cdbvalue(cons_cli[i,2])
                        IF ! EMPTY(mmov_cx)
                                ccomm := ccomm + " AND mov_cx = "+sr_cdbvalue(mmov_cx)
                        ENDIF
                        IF ! EMPTY(mtip)
                                ccomm := ccomm + " AND tipo = "+sr_cdbvalue(mtip)
                        ENDIF
                        IF ! EMPTY(mtip_pg)
                                ccomm := ccomm + " AND tip_pg = "+sr_cdbvalue(mtip_pg)
                        ENDIF
                        IF ! EMPTY(mcartao)
                                ccomm := ccomm + " AND numero = "+sr_cdbvalue(mcartao)
                        ENDIF
                        IF ! EMPTY(mcod_vend)
                                ccomm := ccomm + " AND vendedor = "+sr_cdbvalue(STRZERO(mcod_vend,3))
                        ENDIF
                        IF ! EMPTY(bank)
                                ccomm := ccomm + " AND banco = "+sr_cdbvalue(bank)
                        ENDIF
                        IF ! EMPTY(mcod_oper)
                                ccomm := ccomm + " AND operador = "+sr_cdbvalue(STRZERO(mcod_oper,3))
                        ENDIF
                        IF mtipo_dup = 'S'
                                ccomm := ccomm + " AND juros IS NOT NULL"
                        ENDIF
                        IF ! EMPTY(mloc_pg)
                                ccomm := ccomm + " AND mov_cx = "+sr_cdbvalue(mloc_pg)
                        ENDIF
                        IF mtip_juro = 'S'
                                ccomm := ccomm + " AND juros_d IS NOT NULL"
                        ENDIF
                        IF mdoc_desc = 'S'
                                ccomm := ccomm + " AND desconto IS NOT NULL"
                        ENDIF
                        IF ! EMPTY(marea)
                                ccomm := ccomm + " AND marea = "+sr_cdbvalue(cli->area)
                        ENDIF
                        IF memi_venc = 'S'
                                ccomm := ccomm + " AND emissao = venc"
                        ENDIF
                        IF ! EMPTY(mqtd_dias)
                                ccomm := ccomm + " AND (datpag - venc) <= "+sr_cdbvalue(mqtd_dias)
                        ENDIF
                        sr_getconnection():exec(ccomm,,.t.,@cons_dupr)
                        mcliente := SPACE(40)
                        prog_imp(i,cons_cli[i,3])
                        IF cons_dupr[1,2] = 0
                                LOOP
                        ENDIF
                        IF pag=0 .OR. PROW()>=57
                                pag=pag+1
                                IF pag>1
                                        EJECT
                                ENDIF
                                cabecalho(pag,mtit,mtipo,mprg)
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,00);DEVOUT('Cod. ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Cliente                                  ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Qtd.Doc.')
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Vlr.Med.Doc')
                                DEVPOS(PROW(),PCOL()+2);DEVOUT('Valor Total')
                                DEVPOS(PROW()+1,00);DEVOUT(REPLICATE("-",137))
                        ENDIF
                        DEVPOS(PROW()+1,00);DEVOUT(cons_cli[i,2])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(cons_cli[i,3])
                        DEVPOS(PROW(),PCOL()+3);DEVOUT(TRANSFORM(cons_dupr[1,2],"@E 999,999"))
                        DEVPOS(PROW(),PCOL()+3);DEVOUT(TRANSFORM(cons_dupr[1,1]/cons_dupr[1,2],"@E 999,999.99"))
                        DEVPOS(PROW(),PCOL()+3);DEVOUT(TRANSFORM(cons_dupr[1,1],"@E 999,999.99"))
                        mtot_dup := mtot_dup + cons_dupr[1,2]
                        mtot_doc := mtot_doc + cons_dupr[1,1]
                NEXT
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+3,00);DEVOUT("****** RESUMO FINAL *******")
                DEVPOS(PROW()+1,00);DEVOUT("Total dos Documentos......: "+TRANSFORM(mtot_dup,"99,999"))
                DEVPOS(PROW()+1,00);DEVOUT("Valor Medio p/Documento...: "+TRANSFORM(mtot_doc/mtot_dup,"@E 999,999,999,999.99"))
                DEVPOS(PROW()+1,00);DEVOUT("Valor Total dos Documentos: "+TRANSFORM(mtot_doc,"@E 999,999,999,999.99"))
                DEVPOS(PROW()+2,00);DEVOUT(time())
        ELSE
                mensagem('Aguarde o Coletando dados p/ impressao...')
                *****************************************************
                IF malias = 'dupr'
                        cComm  := "SELECT * FROM sacdupr WHERE datpag >= "+sr_cdbvalue(t_ini)+" AND datpag <= "+sr_cdbvalue(t_fim)+" AND pago ='B'"
                ELSE
                        cComm  := "SELECT * FROM saccred WHERE datpag >= "+sr_cdbvalue(t_ini)+" AND datpag <= "+sr_cdbvalue(t_fim)+" AND pago ='B'"
                ENDIF
                IF ! EMPTY(mcod_cli)
                        ccomm := ccomm + " AND fornec = "+sr_cdbvalue(STRZERO(mcod_cli,5))
                ENDIF
                IF ! EMPTY(mmov_cx)
                        ccomm := ccomm + " AND mov_cx = "+sr_cdbvalue(mmov_cx)
                ENDIF
                IF ! EMPTY(mtip)
                        ccomm := ccomm + " AND tipo = "+sr_cdbvalue(mtip)
                ENDIF
                IF ! EMPTY(mtip_pg)
                        ccomm := ccomm + " AND tip_pg = "+sr_cdbvalue(mtip_pg)
                ENDIF
                IF ! EMPTY(mcartao)
                        ccomm := ccomm + " AND numero = "+sr_cdbvalue(mcartao)
                ENDIF
                IF ! EMPTY(mcod_vend)
                        ccomm := ccomm + " AND vendedor = "+sr_cdbvalue(STRZERO(mcod_vend,3))
                ENDIF
                IF ! EMPTY(bank)
                        ccomm := ccomm + " AND banco = "+sr_cdbvalue(bank)
                ENDIF
                IF ! EMPTY(mcod_oper)
                        ccomm := ccomm + " AND operador = "+sr_cdbvalue(STRZERO(mcod_oper,3))
                ENDIF
                IF mtipo_dup = 'S'
                        ccomm := ccomm + " AND juros IS NOT NULL"
                ENDIF
                IF ! EMPTY(mloc_pg)
                        ccomm := ccomm + " AND mov_cx = "+sr_cdbvalue(mloc_pg)
                ENDIF
                IF mtip_juro = 'S'
                        ccomm := ccomm + " AND juros_d IS NOT NULL"
                ENDIF
                IF mdoc_desc = 'S'
                        ccomm := ccomm + " AND desconto IS NOT NULL"
                ENDIF
                IF ! EMPTY(marea)
                        ccomm := ccomm + " AND marea = "+sr_cdbvalue(cli->area)
                ENDIF
                IF memi_venc = 'S'
                        ccomm := ccomm + " AND emissao = venc"
                ENDIF
                IF ! EMPTY(mqtd_dias)
                        ccomm := ccomm + " AND (datpag - venc) <= "+sr_cdbvalue(mqtd_dias)
                ENDIF
                ccomm := ccomm + " ORDER BY datpag,tipo,duplicata,fornec"
                q_dupr := {}
                sr_getconnection():exec(ccomm,,.t.,@q_dupr)
                //atencao(ccomm)
                IF LEN(q_dupr) = 0
                        atencao('Nao existe documento neste Periodo...')
                        LOOP
                ENDIF
                IF ! imp_arq('DOC_PAGAS.REL','R')
                        EXIT
                ENDIF
                SET PRINT on
                SET DATE brit
                pag:= vencer:= vencidas:= t_vencer:= t_vencidas:= tot_dup:= tot_jur:=;
                tot_des:= vlr_dup:= vlr_jur:= vlr_des:= mtot_dup:= mtot_jur:= mtot_des:=;
                mvlr_dup:= mvlr_jur:= mvlr_des:= mt_dia := mt_pg  := mt_des := mt_jur := ;
                mtot_doc := mvlr_doc := 0
                mdia := q_dupr[1,13]
                IF ! EMPTY(mcod_vend)
                        mtipo := DTOC(t_ini)+' a '+DTOC(t_fim)+' - '+STRZERO(mcod_vend,3)+'-'+mnome_vend
                ELSE
                        mtipo := DTOC(t_ini)+' a '+DTOC(t_fim)
                ENDIF
                mcliente := SPACE(40)
                FOR i = 1 TO LEN(q_dupr)
                        prog_imp(RECNO(),DTOC(q_dupr[i,13]))
                        IF pag=0 .OR. PROW()>=57
                                pag=pag+1
                                IF pag>1
                                        EJECT
                                ENDIF
                                cabecalho(pag,mtit,mtipo,mprg)
                                imprt(mtipo_imp,'C')
                                DEVPOS(PROW()+1,00);DEVOUT('Cod. ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Cliente                                  ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Documento   ')
                                DEVPOS(PROW(),PCOL()+3);DEVOUT('Local')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('D.Pagam ')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Valor Doc.')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Valor Pago')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Dias')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur.Desp.')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(' Emissao')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('Lc')
                                DEVPOS(PROW()+1,00);DEVOUT(REPLICATE("-",137))
                        ENDIF
                        IF ! EMPTY(marea)
                                ver_cli(VAL(q_dupr[i,7]),,,'*')
                                IF marea <> cli->area
                                        LOOP
                                ENDIF
                        ENDIF
                        IF mdia <> q_dupr[i,13]
                                IF mt_dia > 0
                                        DEVPOS(PROW()+1,62);DEVOUT('             ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('----------')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('----------')
                *                       DEVPOS(PROW(),PCOL()+5);DEVOUT('----------')
                                        DEVPOS(PROW()+1,62);DEVOUT('Total do dia:')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mt_dia,'999,999.99'))
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(mt_pg,'999,999.99'))
                *                       DEVPOS(PROW(),PCOL()+5);DEVOUT(TRANSFORM(mt_jur,'999,999.99'))
                                ENDIF
                                mt_dia := mt_pg  := mt_des := mt_jur := 0
                                mdia := q_dupr[i,13]
                        ENDIF
                        IF l_mes<>SUBSTR(DTOC(q_dupr[i,13]),4,5)
                                l_mes=SUBSTR(DTOC(q_dupr[i,13]),4,5)
                                DEVPOS(PROW()+2,00);DEVOUT(l_mes)
                                DEVPOS(PROW()+1,00);DEVOUT('')
                        ENDIF
                        DEVPOS(PROW()+1,00);DEVOUT(q_dupr[i,7])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(q_dupr[i,8])
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(q_dupr[i,2]+q_dupr[i,4]+q_dupr[i,28])
                        IF q_dupr[i,16] = 'B'
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('BANCO')
                        ELSEIF q_dupr[i,16] = 'C'
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('CART.')
                        ELSE
                                DEVPOS(PROW(),PCOL()+1);DEVOUT('     ')
                        ENDIF
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(DTOC(q_dupr[i,13]))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_dupr[i,19],"@E 999,999.99"))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_dupr[i,20],"@E 999,999.99"))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_dupr[i,13] - q_dupr[i,11],"9999"))
                        IF mdoc_desc = 'S'
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_dupr[i,22],"@E 99,999.99"))
                        ELSE
                                DEVPOS(PROW(),PCOL()+1);DEVOUT(TRANSFORM(q_dupr[i,24],"@E 99,999.99"))
                        ENDIF
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(DTOC(q_dupr[i,10]))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(DTOC(q_dupr[i,11]))
                        DEVPOS(PROW(),PCOL()+1);DEVOUT(q_dupr[i,27])
                        IF ! EMPTY(q_dupr[i,47])
                                DEVPOS(PROW()+1,00);DEVOUT(q_dupr[i,47])
                        ENDIF
                        tot_dup  :=tot_dup+1
                        mtot_dup :=mtot_dup+1
                        vlr_dup  :=vlr_dup+q_dupr[i,20]
                        mvlr_dup :=mvlr_dup+q_dupr[i,20]
                        mvlr_doc :=mvlr_doc+q_dupr[i,19]
                        mtot_doc := mtot_doc+q_dupr[i,19]
                        IF q_dupr[i,24] > 0
                                mjuros_d := mjuros_d + q_dupr[i,24]
                                mjur_tot ++
                        ENDIF
                        IF q_dupr[i,20]>q_dupr[i,19]
                                vlr_jur=vlr_jur+(q_dupr[i,20]-q_dupr[i,19])
                                tot_jur=tot_jur+1
                                mt_jur=mt_jur+(q_dupr[i,20]-q_dupr[i,19])
                                mvlr_jur=mvlr_jur+(q_dupr[i,20]-q_dupr[i,19])
                                mtot_jur=mtot_jur+1
                        ENDIF
                        IF q_dupr[i,20]<q_dupr[i,19]
                                vlr_des := vlr_des+(q_dupr[i,19]-q_dupr[i,20])
                                tot_des := tot_des+1
                                mt_des  := mt_des+(q_dupr[i,19]-q_dupr[i,20])
                                mvlr_des:= mvlr_des+(q_dupr[i,19]-q_dupr[i,20])
                                mtot_des:= mtot_des+1
                        ENDIF
                        mt_pg  := mt_pg  + q_dupr[i,20]
                        mt_dia := mt_dia + q_dupr[i,19]
                        IF l_mes<>SUBSTR(DTOC(q_dupr[i,13]),4,5)
                                IF PROW()<57
                                        DEVPOS(PROW()+1,00);DEVOUT("*** RESUMO DO MES **")
                                        DEVPOS(PROW()+2,00);DEVOUT("Total Documentos...: "+TRANSFORM(tot_dup,"9999")+" - "+TRANSFORM(mvlr_doc,"@E 999,999,999,999.99"))
                                        DEVPOS(PROW()+1,00);DEVOUT("Total de Juros.....: "+TRANSFORM(tot_jur,"9999")+" - "+TRANSFORM(vlr_jur,"@E 999,999,999,999.99"))
                                        DEVPOS(PROW()+1,00);DEVOUT("Total de Descontos.: "+TRANSFORM(tot_des,"9999")+" - "+TRANSFORM(vlr_des,"@E 999,999,999,999.99"))
                                        DEVPOS(PROW()+1,00);DEVOUT("Total de Doc. Pagos: "+TRANSFORM(tot_dup,"9999")+" - "+TRANSFORM(vlr_dup,"@E 999,999,999,999.99"))
                                        DEVPOS(PROW()+1,00);DEVOUT('')
                                ELSE
                                        EJECT
                                        pag=pag+1
                                        cabecalho(pag,mtit,mtipo,mprg)
                                        imprt(mtipo_imp,'C')
                                        DEVPOS(PROW()+1,00);DEVOUT('Cod. ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Cliente                                  ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Documento   ')
                                        DEVPOS(PROW(),PCOL()+3);DEVOUT('Local')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('D.Pagam ')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Valor Doc.')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Valor Pago')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Dias')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Jur.Desp.')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT(' Emissao')
                                        DEVPOS(PROW(),PCOL()+1);DEVOUT('Vencimen')
                                        DEVPOS(PROW()+1,00);DEVOUT(REPLICATE("-",137))
                                        DEVPOS(PROW()+2,00);DEVOUT(l_mes)
                                        DEVPOS(PROW()+1,00);DEVOUT("*** RESUMO DO MES **")
                                        DEVPOS(PROW()+2,00);DEVOUT("Total Documentos...: "+TRANSFORM(tot_dup,"9999")+" - "+TRANSFORM(mvlr_doc,"@E 999,999,999,999.99"))
                                        DEVPOS(PROW()+1,00);DEVOUT("Total de Juros.....: "+TRANSFORM(tot_jur,"9999")+" - "+TRANSFORM(vlr_jur,"@E 999,999,999,999.99"))
                                        DEVPOS(PROW()+1,00);DEVOUT("Total de Descontos.: "+TRANSFORM(tot_des,"9999")+" - "+TRANSFORM(vlr_des,"@E 999,999,999,999.99"))
                                        DEVPOS(PROW()+1,00);DEVOUT("Total de Doc. Pagos: "+TRANSFORM(tot_dup,"9999")+" - "+TRANSFORM(vlr_dup,"@E 999,999,999,999.99"))
                                ENDIF
                                l_mes=SUBSTR(DTOC(q_dupr[i,13]),4,5)
                                tot_dup:=tot_jur:=tot_des:=vlr_dup:=vlr_jur:=vlr_des:=mvlr_doc:=0
                        ENDIF
                NEXT
                IF PROW() >= 52 .OR. pag = 0
                        pag=pag+1
                        cabecalho(pag,mtit,mtipo,mprg)
                ENDIF
                imprt(mtipo_imp,'N')
                DEVPOS(PROW()+3,00);DEVOUT("****** RESUMO FINAL *******")
                DEVPOS(PROW()+1,00);DEVOUT("Total dos Documentos......: "+TRANSFORM(mtot_dup,"99,999")+" - "+TRANSFORM(mtot_doc,"@E 999,999,999,999.99"))
                DEVPOS(PROW()+1,00);DEVOUT("Total de Juros............: "+TRANSFORM(mtot_jur,"99,999")+" - "+TRANSFORM(mvlr_jur,"@E 999,999,999,999.99"))
                DEVPOS(PROW()+1,00);DEVOUT("Total de Descontos........: "+TRANSFORM(mtot_des,"99,999")+" - "+TRANSFORM(mvlr_des,"@E 999,999,999,999.99"))
                DEVPOS(PROW()+1,00);DEVOUT("Total de Documentos Pagos.: "+TRANSFORM(mtot_dup,"99,999")+" - "+TRANSFORM(mvlr_dup,"@E 999,999,999,999.99"))
                DEVPOS(PROW()+1,00);DEVOUT("Total de Juros Dispencados: "+TRANSFORM(mjur_tot,"99,999")+" - "+TRANSFORM(mjuros_d,"@E 999,999,999,999.99"))
                DEVPOS(PROW()+2,00);DEVOUT(time())
        ENDIF
        EJECT                                                                                                                                                                                                                                                                                                                                                                                
        SETPRC(00,00)                                                                                                                                                                                                                                                                                                                                                                        
        SET DEVI TO SCREEN;SET PRINT TO;SET PRINT OFF                                                                                                                                                                                                                                                                                                                                        
        conf_impressao('DOC_PAGAS.REL')
ENDDO
wvw_lclosewindow()
RETURN NIL




